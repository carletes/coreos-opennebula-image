{
    "builders": [
        {
            "accelerator": "{{user `accelerator`}}",
            "boot_command": [
                "sudo -i<enter>",
                "systemctl stop sshd.socket<enter>",
                "wget http://{{ .HTTPIP }}:{{ .HTTPPort }}/install.yml<enter>",
                "coreos-install -d {{user `install_target`}} -C {{user `coreos_channel`}} -c install.yml<enter>",
                "reboot<enter>"
            ],
            "boot_wait": "{{user `boot_wait`}}",
            "communicator": "ssh",
            "disk_size": 10240,
            "format": "qcow2",
            "headless": "{{user `headless`}}",
            "http_directory": "files",
            "iso_checksum": "{{user `iso_checksum`}}",
            "iso_checksum_type": "{{user `iso_checksum_type`}}",
            "iso_url": "http://{{user `coreos_channel`}}.release.core-os.net/amd64-usr/{{user `coreos_version`}}/coreos_production_iso_image.iso",
            "output_directory": "builds/coreos-{{user `coreos_channel`}}-{{user `coreos_version`}}-qemu",
            "qemuargs": [
                ["-m", "{{user `memory`}}"],
                ["-fsdev", "local,id=conf,security_model=none,readonly,path={{pwd}}/files"],
                ["-device", "virtio-9p-pci,fsdev=conf,mount_tag=config-2"],
                ["-device", "virtio-net,netdev=user.0"]
            ],
            "shutdown_command": "sudo -S shutdown -P now",
            "ssh_private_key_file": "files/vagrant_id_rsa",
            "ssh_timeout": "60m",
            "ssh_username": "core",
            "type": "qemu"
        }
    ],
    "description": "CoreOS image for OpenNebula",
    "provisioners": [
        {
            "destination": "/home/core",
            "source": "oem/",
            "type": "file"
        },
        {
            "environment_vars": [
                "REMOVE_VAGRANT_KEY={{user `remove_vagrant_key`}}"
            ],
            "scripts": [
                "scripts/oem.sh",
                "scripts/cleanup.sh"
            ],
            "type": "shell"
        }
    ],
    "variables": {
        "accelerator": "kvm",
        "boot_wait": "60s",
        "coreos_channel": "alpha",
        "coreos_version": "<not-set>",
        "headless": "false",
        "install_target": "/dev/vda",
        "iso_checksum": "<not-set>",
        "iso_checksum_type": "md5",
        "memory": "1024",
        "remove_vagrant_key": "true"
    }
}
